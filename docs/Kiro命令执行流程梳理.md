# Kiro 工作流命令执行流程梳理

## 🎯 核心工作流命令

### 1. `/kiro-start` - 启动功能开发
**执行流程**：
1. 安全检查 → 加载项目上下文
2. 数据库配置检测 → 自动执行备份（如检测到）/ 询问用户确认（如未检测到）
3. Git 工作区状态检查 → 如有问题则停止并询问处理方式
4. 创建功能分支 `feature/[name]` → 如失败则停止并提供解决建议
5. 启动需求收集阶段 → 创建 requirements.md
6. 用户批准检查点 → 进入设计阶段

**数据流转**：
- 输入：功能名称
- 创建：`.specs/{feature}/requirements.md`、功能分支、备份文件
- 输出：需求文档、用户批准请求

**错误处理原则**：
- 遇到任何错误立即停止执行
- 提供清晰的错误描述和建议解决方案
- 询问用户明确指示如何处理
- 等待用户确认后才执行恢复操作

### 2. `/kiro-next` - 执行下一个任务
**执行流程**：
1. 读取 tasks.md → 找到下一个未完成任务
2. 执行单个任务 → 严格的一次只做一件事
3. 实时更新任务状态
4. 停止并等待用户确认 → 不自动继续

**数据流转**：
- 输入：当前 tasks.md 状态
- 处理：执行代码实现
- 输出：更新的 tasks.md、完成报告

### 3. `/kiro-save` - 保存进度
**执行流程**：
1. 更新 tasks.md 当前进度
2. 静默提交 Git（checkpoint 消息）
3. 保存会话状态到 session.md
4. 显示极简输出（功能、阶段、进度）

**数据流转**：
- 输入：当前工作状态
- 更新：tasks.md、session.md、Git 历史
- 输出：会话恢复提示

### 4. `/kiro-load` - 加载会话状态  
**执行流程**：
1. 首先读取 ./CLAUDE.md 文件（恢复全局规则和配置）
2. 检测项目根目录（Glob 检查 .specs 文件）
3. 读取 .specs/session.md 文件内容（恢复会话状态）
4. 解析会话内容提取功能名称、当前阶段、任务进度、文件引用
5. 验证 Git 分支 → 切换到正确分支
6. 加载所有 SPECS 文档 → 显示当前状态

**数据流转**：
- 输入：保存的 session.md、CLAUDE.md 配置
- 加载：所有 SPECS 文档、Git 状态、项目配置
- 输出：完整恢复的工作上下文、继续建议

### 5. `/kiro-end` - 完成功能开发
**执行流程**：
1. 更新所有文档为完成状态
2. 生成功能总结 summary.md
3. 归档散落文件到功能目录
4. 移动 session.md 到功能目录（历史保存）
5. 提交所有更改
6. 创建 PR 或合并到 main 分支

**数据流转**：
- 输入：完成的功能状态
- 生成：summary.md、归档文件
- 输出：合并的主分支、清理的工作区

---

## 🔧 辅助管理命令

### 6. `/kiro-info` - 项目信息配置
**执行流程**：
1. 解析用户输入的项目信息
2. 配置 .gitignore（首次使用）
3. 保存到 project-info.md
4. 后续所有会话自动加载

**数据流转**：
- 输入：项目描述信息
- 创建：project-info.md、.gitignore 条目
- 输出：持久化的项目配置

### 7. `/kiro-status` - 查看项目状态
**执行流程**：
1. 检测当前项目（Glob 查找 .specs 文件）
2. 收集状态信息 → session.md、Git、tasks.md
3. 计算完成百分比
4. 中文格式化显示状态

**数据流转**：
- 输入：当前项目所有状态文件
- 处理：状态汇总、进度计算
- 输出：格式化的状态报告

### 8. `/kiro-think` - 深度思考模式
**执行流程**：
1. 激活指定级别的思考模式（v1/v2/v3）
2. 深度分析用户问题
3. 展示分析结果和建议
4. 获取用户确认后执行（如需要）
5. 自动保存分析结果到 docs/ 目录

**数据流转**：
- 输入：问题描述、思考级别
- 处理：多角度分析、方案比较
- 输出：分析文档、实施建议

### 9. `/kiro-git` - 快速代码提交
**执行流程**：
1. 立即提交当前分支的所有更改
2. 生成描述性提交消息
3. 不与主分支交互
4. 显示提交状态

**数据流转**：
- 输入：当前工作区更改
- 处理：Git add + commit
- 输出：提交确认消息

### 10. `/kiro-sync` - 同步讨论结果到文档

### 11. `/kiro-analyze` - AI智能代码分析
**执行流程**：
1. 读取项目上下文 → project-info.md、项目结构扫描
2. 分析目标特征 → 识别代码类型、复杂度、功能领域
3. AI推理选择专家 → 基于项目技术栈和分析需求
4. 委托专家执行分析 → 生成结构化分析文档
5. 保存分析结果 → .specs/analysis/ 目录

**数据流转**：
- 输入：分析目标（文件/目录/函数/项目）
- 处理：AI推理 → 专家选择 → 深度分析
- 输出：时间戳命名的分析文档

### 12. `/kiro-fix` - Bug修复工作流
**执行流程**：
1. 检测当前功能上下文 → 创建 bugs/目录
2. 生成问题文档 → bug-report.md, analysis.md
3. 创建修复任务 → fix-tasks.md (状态: ACTIVE)
4. 自然语言交流完成修复 → 更新状态为 VERIFIED

**数据流转**：
- 输入：bug名称
- 创建：bugs/子目录、问题文档、修复任务
- 输出：修复验证结果
**执行流程**：
1. 分析当前会话上下文 → 提取变更决策
2. 识别需要更新的SPECS文档类型
3. 读取现有文档 → 生成更新版本
4. 显示before/after对比 → 要求用户确认
5. 执行原子性更新 → 保持文档一致性
6. 提交变更并提供完成反馈

**数据流转**：
- 输入：对话上下文、现有SPECS文档
- 处理：内容分析、文档生成、一致性验证
- 输出：更新的requirements.md/design.md/tasks.md

---

## 📊 流程依赖关系

### 线性依赖链
```
/kiro-info → /kiro-start → /kiro-next → /kiro-next → ... → /kiro-end
```

### 辅助流程
```
/kiro-save ↔ /kiro-load      （配对使用）
/kiro-status ← 任何时候       （独立查看）
/kiro-think → /kiro-sync     （配对使用：分析→同步）
/kiro-analyze ← 任何时候      （独立代码分析）
/kiro-git ← 开发过程         （独立提交）
```

### 数据流图
```
project-info.md → 所有命令（项目配置）
session.md → save/load（状态持久化）
tasks.md → next/status（进度跟踪）
requirements.md → start/next（需求引用）
design.md → start/next（设计引用）
analysis/ → analyze（分析结果存储）
```

---

## 🎭 流程特点分析

### 优势
1. **完整闭环**：覆盖开发全生命周期
2. **状态可恢复**：支持中断和恢复
3. **进度可视化**：清晰的阶段和任务状态
4. **安全机制**：分支隔离、数据库自动备份、错误处理
5. **模块化设计**：12个命令各司其职，易于理解和维护

### 复杂度
1. **命令数量**：12个命令需要学习
2. **状态同步**：多个文件需要保持一致
3. **流程分支**：多种路径和异常情况
4. **认知负荷**：需要理解命令间关系

### 核心价值
1. **结构化开发**：强制规范的开发流程
2. **AI 协作优化**：专为 AI 辅助开发设计
3. **中文友好**：本土化的交互体验
4. **会话连续性**：跨会话的项目状态管理
5. **错误安全**：遇到错误时用户保持完全控制权
6. **数据保护**：强制数据库备份，防止开发过程中的数据丢失

## 📋 关键设计原则

### 数据库备份策略
- **检测到数据库配置**：自动执行备份（无需询问）
- **未检测到数据库配置**：必须询问用户确认
- **备份失败**：停止操作，提供建议，等待用户指示

### 错误处理策略
- **简单原则**：错误 → 建议 → 询问 → 等待用户指示 → 执行
- **用户决策权**：AI 不对错误处理做任何假设
- **透明性**：清晰描述错误和可能的解决方案
- **安全性**：绝不跳过重要的安全检查

### Think-Change 工作流
- **`/kiro-think`**：深度分析问题，讨论解决方案（不修改文档）
- **`/kiro-sync`**：将讨论结果同步到 SPECS 文档（原子操作）
- **`/kiro-fix`**：快速bug修复工作流（轻量级文档+单会话完成）
- **配对使用**：先思考分析，再同步变更，确保变更的准确性